<html>
<script src="terra.min.js"></script>

<body>
    <canvas id="voronoi"></canvas>
    
</body>

<script>
var colors = [];  
colors[0] = "255,0,0,1" //red
colors[1] = "0,255,0,1" //green
colors[2] = "0,0,255,1" //blue
colors[3] = "255,255,0,1" //yellow
colors[4] = "0,255,255,1" //aqua
colors[5] = "255,0,255,1" //fuchsia
colors[6] = "0,128,128,1" //teal
colors[7] = "128,128,128,1" //gray

var initPointProb = 0.001; 
var initPointsNumber = 0;

var world = new terra.Terrarium(120, 120, {
  cellSize: 5,
  periodic: true
});

terra.registerCA({
  type: 'voronoi',
  colorFn: function () {     
    if(this.distance == 0){
      return "0,0,0,1";
    }
    if(this.isBorder){
      return "0,0,0,1";
    }
    if(this.point == -1){
      return "255,255,255,1";
    } else {
      return colors[this.point];
    }
  },
  process: function (neighbors, x, y) {    
    if(this.isPoint){
      return true;
    } 
    this.isBorder = false;
    for(var i = 0; i < neighbors.length; ++i){
      if(neighbors[i].creature.point != this.point){
        this.isBorder = true;
      }

      if(neighbors[i].creature.distance < this.distance){
        this.distance = neighbors[i].creature.distance+1;
        this.point = neighbors[i].creature.point;
      }
    }
    
    return true;
  }
}, function () {
  this.isBorder = false;
  if(initPointsNumber < colors.length){
    var rnd = Math.random();  
    this.isPoint = rnd < initPointProb;
  }
  if(this.isPoint){
    this.distance = 0;
    this.point = initPointsNumber;
    initPointsNumber++;    
  } else {
    this.point = -1;
    this.distance = 10000;
  }
});

world.grid = world.makeGrid('voronoi');
world.animate();

</script>

</html>
