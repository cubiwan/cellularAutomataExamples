<html>
<script src="terra.js"></script>
<script src="terraUtils.js"></script>

<body>

    
</body>

<script>

/*var R0 = 2.5;
var startIll = 0.01; //prob. of start ill
var startInmune = 0; //prob. of start inmune
var illDuration = 15; //duration of illness (cicles)
var pc = (R0/8)/illDuration; //prob. of get illness*/

terra.registerCA({
  type: 'ill',
  colorFn: function () { 
    if(this.isIll){
      return '255,0,0,1';
    } else if(this.wasIll){
      return '255,105,0,1';
    } else if(this.isInmune){
      return '0,0,255,1';
    } else {
      return '0,255,0,1';
    }
  },
  process: function (neighbors, x, y) {    
    if(!this.isIll && !this.wasIll && !this.isInmune){
      var surrounding = neighborsCount(neighbors, 'isIll', true);
      if(Math.random() < 1-Math.pow(1-config.pc, surrounding)){
        this.isIll = true;          
        this.timesIll = config.illDuration;
      }
    } else if(this.isIll){
      this.timesIll--;
      if(this.timesIll == 0){
        this.isIll = false;
        this.wasIll = true;
      }
    }
    return true;
  }
}, function () {
  if(worldStarted){
    this.isIll = false;
    this.timesIll = 0;
    this.isInmune = false
    this.wasIll = false;
  } else { 
    this.isIll = withProbability(config.startIll, true, false);
    if(this.isIll){
      this.timesIll = config.illDuration;
    } else { 
      this.timesIll = 0;
      this.isInmune = withProbability(config.startInmune, true, false);
    }
    this.wasIll = false;
  }
});

config.size = 150;
config.cellSize = 5;
config.periodic = true;
config.grid = 'ill';
config.r0 = 2.5;
config.startIll = 0.001; //prob. of start ill
config.startInmune = 0; //prob. of start inmune
config.illDuration = 14; //duration of illness (cicles)
config.pc = (config.r0/8)/config.illDuration;
config.population = config.size*config.size;

uiAddLabel("label1", "  R0: ");
uiAddButton("r05Button", "0.5", "config.r0 = 0.5; update()");
uiAddButton("r1Button", "1.0", "config.r0 = 1; update()");
uiAddButton("r13Button", "1.3", "config.r0 = 1.3; update()");
uiAddButton("r15Button", "1.5", "config.r0 = 1.5; update()");
uiAddButton("r25Button", "2.5", "config.r0 = 2.5; update()");
uiAddButton("r5Button", "5", "config.r0 = 5; update()");
uiAddLabel("label2", "  Duration: ");
uiAddButton("d5Button", "5", "config.illDuration = 5; update()");
uiAddButton("d7Button", "7", "config.illDuration = 7; update()");
uiAddButton("d143Button", "14", "config.illDuration = 14; update()");
uiAddButton("d21Button", "21", "config.illDuration = 21; update()");
uiAddLabel("label3", " Start Ills: ");
uiAddButton("ill001Button", "0.01%", "config.startIll = 0.0001; update()");
uiAddButton("ill001Button", "0.1%", "config.startIll = 0.001; update()");
uiAddLabel("label4", " Start Inmunes: ");
uiAddButton("inmune01Button", "0%", "config.startInmune = 0; update()");
uiAddButton("inmune01Button", "0.1%", "config.startInmune = 0.001; update()");
uiAddButton("inmune1Button", "1%", "config.startInmune = 0.01; update()");
uiAddButton("inmune10Button", "10%", "config.startInmune = 0.1; update()");
uiAddButton("inmune20Button", "20%", "config.startInmune = 0.2; update()");
uiAddButton("inmune50Button", "50%", "config.startInmune = 0.5; update()");
uiAddButton("inmune70Button", "70%", "config.startInmune = 0.7; update()");
uiAddLabel("label5", "  Size: ")
uiAddButton("size50Button", "Small", "config.size = 50; config.population = 50*50; update()");
uiAddButton("size150Button", "Medium", "config.size = 150; config.population = 150*150; update()");
uiAddButton("size200Button", "Big", "config.size = 200; config.population = 200*200; update()");

uiAddStatusbar("R0", "r0");
uiAddStatusbar("Duration", "illDuration");
uiAddStatusbar("Inital ills", "startIll");
uiAddStatusbar("Inmunes", "startInmune");
uiAddStatusbar("Population", "population");

function update(){
  config.pc = (config.r0/8)/config.illDuration;
  reload();
}

</script>

</html>